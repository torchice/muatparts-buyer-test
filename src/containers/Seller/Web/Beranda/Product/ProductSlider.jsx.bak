import { Fragment, useState } from 'react';
import styles from "./ProductSlider.module.scss"
import IconComponent from '@/components/IconComponent/IconComponent';
// LBM - OLIVER - PASSING STATE LOADING UNTUK SKELETON - MP - 020
import ProductComponentSkeleton from '@/components/ProductComponent/ProductComponentSkeleton';
import ProductComponent from '@/components/ProductComponent/ProductComponent';
import { useTranslation } from '@/services/languageTranslate';

// LBM - OLIVER - PASSING STATE LOADING UNTUK SKELETON - MP - 020
const ProductSlider = ({ products = [], title, sellerProfile, isLoading }) => {
  const {t} = useTranslation()
  const [currentIndex, setCurrentIndex] = useState(0);
  const itemWidth = 170; // Width of each product card
  const itemGap = 12; // Gap between cards
  const itemsPerView = 6; // Number of items visible at once
  const maxIndex = Math.max(0, products.length - itemsPerView);

  const handlePrevious = () => {
    setCurrentIndex((prevIndex) => Math.max(0, prevIndex - 1));
  };

  const handleNext = () => {
    setCurrentIndex((prevIndex) => Math.min(maxIndex, prevIndex + 1));
  };

  // Calculate container width: 6 cards * (170px width) + 5 gaps * (12px)
  const containerWidth = (itemsPerView * itemWidth) + ((itemsPerView - 1) * itemGap);

  if (!products || products.length === 0) {
    return null;
  }

  const translateX = currentIndex * (itemWidth + itemGap);

  return (
    <div className="flex flex-col w-full gap-y-5">
      <span className="font-bold text-[18px] leading-[21.6px]">
        {title}
      </span>

      <div className="relative" style={{ width: `${containerWidth}px` }}>
        <div className="relative overflow-hidden">
          <div 
            className="flex gap-3 transition-transform duration-300 ease-in-out"
            style={{ transform: `translateX(-${translateX}px)` }}
          >
            {/* LBM - OLIVER - PASSING STATE LOADING UNTUK SKELETON - MP - 020 */}
            {isLoading ? (
              Array(6).fill('').map(() => <ProductComponentSkeleton />)
            ) : products.map((product, key) => (
              <Fragment key={key}>
                {/* FIX BUG Profil Seller Sisi Buyer LB-0020 */}
                {/* FIX BUG Profil Seller Sisi Buyer LB-0049 */}
                {/* FIX BUG Pengecekan Ronda Muatparts LB-0257 */}
                {/* FIX BUG Pengecekan Ronda Muatparts LB-0258 */}
                {/* FIX BUG Pengecekan Ronda Muatparts LB-0304 */}
                {/* 25. 03 - QC Plan - Web - Pengecekan Ronda Muatparts - Tahap 2 - LB - 0529 */}
                <ProductComponent
                  ID={product.id}
                  Photo={product.imageSrc}
                  SalesType={product.isGrosir ? t("LabelproductCardGrosir") : ""}
                  Stock={product.stock}
                  Grade={product.grade}
                  Name={product.title}
                  PriceBeforeDiscount={product.originalPrice}
                  PriceAfterDiscount={product.discountedPrice}
                  Discount={product.discount}
                  Store={sellerProfile?.name}
                  City={sellerProfile?.location}
                  Rating={product.rating}
                  SoldCount={product.sales}
                  Wishlist={product.isWishlisted}
                />
              </Fragment>
            ))}
          </div>
        </div>

        {(products.length > itemsPerView && !isLoading) && (
          <>
            {currentIndex > 0 && (
              <button
                onClick={handlePrevious}
                className="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 bg-white rounded-full p-2 shadow-muat hover:bg-gray-50 z-10 size-10 flex"
                aria-label="Previous products"
              >
                <IconComponent
                  classname={`m-auto rotate-180 ${styles.icon_arrow}`}
                  src="/icons/chevron-right2.svg"
                />
              </button>
            )}
            {currentIndex < maxIndex && (
              <button
                onClick={handleNext}
                className="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 bg-white rounded-full p-2 shadow-muat hover:bg-gray-50 z-10 size-10 flex"
                aria-label="Next products"
              >
                <IconComponent
                  classname={`m-auto ${styles.icon_arrow}`}
                  src="/icons/chevron-right2.svg"
                  width={9}
                  height={16}
                />
              </button>
            )}
          </>
        )}
      </div>
    </div>
  );
};

export default ProductSlider;